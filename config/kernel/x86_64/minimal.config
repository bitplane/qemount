# Minimal kernel config for afuse99p PoC (x86_64 ISO9660 microVM)
CONFIG_EXPERT=y
CONFIG_INIT_ENV_ARG_LIMIT=32
CONFIG_KERNEL_XZ=y
CONFIG_SYSVIPC=y
CONFIG_POSIX_MQUEUE=y
CONFIG_FHANDLE=y
CONFIG_NO_HZ=y
CONFIG_HIGH_RES_TIMERS=y
CONFIG_BPF_SYSCALL=y
CONFIG_PREEMPT_VOLUNTARY=y
CONFIG_BLK_DEV_INITRD=y
CONFIG_INITRAMFS_SOURCE=""
CONFIG_RD_GZIP=y
CONFIG_RD_BZIP2=y
CONFIG_RD_LZMA=y
CONFIG_RD_XZ=y
CONFIG_RD_LZO=y
CONFIG_RD_LZ4=y
CONFIG_CC_OPTIMIZE_FOR_PERFORMANCE=y
CONFIG_EMBEDDED=y
CONFIG_PERF_EVENTS=n

# Basic memory config
CONFIG_SLAB=y

# Core CPU support (critical)
CONFIG_SMP=y
CONFIG_X86_64=y 
CONFIG_64BIT=y
CONFIG_ACPI=y
CONFIG_CPU_FREQ=y

# Networking (for Dropbear or SSHFS)
CONFIG_INET=y
CONFIG_NET=y
CONFIG_PACKET=y
CONFIG_UNIX=y
CONFIG_NET_KEY=y
CONFIG_NETFILTER=y
CONFIG_VETH=m
CONFIG_TUN=y

# Virtio drivers
CONFIG_VIRTIO=y
CONFIG_VIRTIO_PCI=y
CONFIG_VIRTIO_BLK=y
CONFIG_VIRTIO_NET=y
CONFIG_VIRTIO_MMIO=y
CONFIG_VIRTIO_CONSOLE=y

# Block dev and filesystems
CONFIG_BLK_DEV=y
CONFIG_BLK_DEV_LOOP=y
CONFIG_BLOCK=y
CONFIG_TMPFS=y
CONFIG_TMPFS_POSIX_ACL=y
CONFIG_ISO9660_FS=m
CONFIG_EXT4_FS=m
CONFIG_SQUASHFS=m

# Device filesystems
CONFIG_DEVTMPFS=y
CONFIG_DEVTMPFS_MOUNT=y

# Filesystem support
CONFIG_PROC_FS=y
CONFIG_SYSFS=y

# PCI
CONFIG_PCI=y

# USB (disabled to speed up build)
CONFIG_USB_SUPPORT=n

# Misc
CONFIG_PRINTK=y
CONFIG_EARLY_PRINTK=y
CONFIG_KALLSYMS=y
CONFIG_MAGIC_SYSRQ=y
CONFIG_DEBUG_KERNEL=y
CONFIG_DEBUG_INFO=n
CONFIG_FRAME_POINTER=y
CONFIG_SERIAL_8250=y
CONFIG_SERIAL_8250_CONSOLE=y

# Add basic ATA/SCSI support for CD-ROM detection
CONFIG_ATA=y
CONFIG_SCSI=y
CONFIG_BLK_DEV_SD=y
CONFIG_BLK_DEV_SR=y

# Make sure VM stuff works
CONFIG_TTY=y
CONFIG_VT=y
CONFIG_VT_CONSOLE=y